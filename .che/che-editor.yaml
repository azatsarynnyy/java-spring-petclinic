inline:
  schemaVersion: 2.1.0
  metadata:
    name: eclipse/che-theia/next
  commands:
      - id: init-remote-runtime-injector
        apply:
          component: remote-runtime-injector
    events:
      preStart:
        - init-remote-runtime-injector
    components:
      - name: theia-ide
        container:
          image: 'quay.io/eclipse/che-theia:next'
          env:
            - name: THEIA_PLUGINS
              value: 'local-dir:///plugins'
            - name: HOSTED_PLUGIN_HOSTNAME
              value: 0.0.0.0
            - name: HOSTED_PLUGIN_PORT
              value: '3130'
            - name: THEIA_HOST
              value: 127.0.0.1
          volumeMounts:
            - name: plugins
              path: /plugins
            - name: theia-local
              path: /home/theia/.theia
          mountSources: true
          memoryLimit: 512M
          cpuLimit: 1500m
          cpuRequest: 100m
          endpoints:
            - name: theia
              exposure: public
              secure: true
              targetPort: 3100
              attributes:
                type: main
                cookiesAuthEnabled: true
                discoverable: false
                urlRewriteSupported: true
              protocol: http
            - name: webviews
              targetPort: 3100
              exposure: public
              secure: true
              protocol: http
              attributes:
                type: webview
                cookiesAuthEnabled: true
                discoverable: false
                unique: true
                urlRewriteSupported: true
            - name: mini-browser
              targetPort: 3100
              exposure: public
              secure: true
              protocol: http
              attributes:
                type: mini-browser
                cookiesAuthEnabled: true
                discoverable: false
                unique: true
                urlRewriteSupported: true
            - name: theia-dev
              targetPort: 3130
              exposure: public
              protocol: http
              attributes:
                type: ide-dev
                discoverable: false
                urlRewriteSupported: true
            - name: theia-redirect-1
              targetPort: 13131
              exposure: public
              protocol: http
              attributes:
                discoverable: false
                urlRewriteSupported: true
            - name: theia-redirect-2
              targetPort: 13132
              exposure: public
              protocol: http
              attributes:
                discoverable: false
                urlRewriteSupported: true
            - name: theia-redirect-3
              targetPort: 13133
              exposure: public
              protocol: http
              attributes:
                discoverable: false
                urlRewriteSupported: true
        attributes:
          app.kubernetes.io/component: che-theia
          app.kubernetes.io/part-of: che-theia.eclipse.org
          ports:
            - exposedPort: 3100
            - exposedPort: 3130
            - exposedPort: 13131
            - exposedPort: 13132
            - exposedPort: 13133
